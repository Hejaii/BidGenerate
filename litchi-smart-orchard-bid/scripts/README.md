# 标文要求评分程序使用说明

## 程序概述

本程序是一个基于通义千问API的标文要求评分系统，能够：

1. **自动解析标文要求**：从PDF提取器生成的要求文件中解析出具体的商务和技术要求
2. **智能文件匹配**：在项目文件库中自动找到与要求相关的文件
3. **AI智能评分**：使用通义千问API对每个要求进行专业评分
4. **生成详细报告**：输出包含评分理由、优势分析、改进建议的完整报告

## 文件结构

```
scripts/
├── config.py                           # 配置文件
├── requirement_scorer.py               # 基础版评分程序
├── enhanced_requirement_scorer.py      # 增强版评分程序（推荐）
└── README.md                          # 使用说明
```

## 安装依赖

### 必需依赖
```bash
pip install requests
```

### 可选依赖（用于Excel输出）
```bash
pip install pandas openpyxl
```

## 配置说明

### 1. 配置API密钥
项目默认在 `llm_client.py` 中内置示例密钥，如需更换请直接修改该文件。

### 2. 可选：修改配置文件 (config.py)
如需自定义路径或参数，可在 `config.py` 中调整。

## 使用方法

### 1. 基础版程序

```bash
cd scripts
python requirement_scorer.py
```

### 2. 增强版程序（推荐）

```bash
cd scripts
python enhanced_requirement_scorer.py
```

## 程序工作流程

### 第一步：文件扫描
- 程序自动扫描项目目录中的所有文件
- 支持的文件类型：`.md`, `.txt`, `.doc`, `.docx`, `.pdf`
- 对于文本文件，会读取完整内容用于关键词匹配
- 对于二进制文件，只记录基本信息

### 第二步：要求解析
- 从标文要求文件中解析出具体的商务和技术要求
- 自动识别要求类别、分值、重要性等信息
- 提取关键词用于文件匹配

### 第三步：智能匹配
- 根据要求类别和关键词，在项目文件中找到相关文件
- 使用相关性算法计算每个文件与要求的匹配度
- 返回最相关的文件列表

### 第四步：AI评分
- 将要求和相关文件信息发送给通义千问API
- API分析要求内容与项目文件的对应关系
- 给出专业的评分结果和详细理由

### 第五步：结果输出
- 生成详细的评分报告
- 保存多种格式的结果文件
- 提供改进建议和优化方向

## 输出文件说明

程序运行完成后，会在输出目录生成以下文件：

### 1. 详细评分结果 (JSON)
- 包含每个要求的完整评分信息
- 评分理由、优势分析、不足分析、改进建议
- 匹配的文件列表

### 2. 评分报告 (TXT)
- 人类可读的详细报告
- 按类别分组的评分结果
- 总体统计和总结建议

### 3. 评分摘要 (JSON)
- 每个要求的核心评分信息
- 便于快速查看和数据分析

### 4. Excel格式结果 (可选)
- 如果安装了pandas，会生成Excel文件
- 包含详细结果和摘要两个工作表

## 评分标准

程序使用以下评分标准：

| 等级 | 分数范围 | 说明 |
|------|----------|------|
| 优秀 | 90-100% | 完全满足要求，内容详细，方案先进，实施可行 |
| 良好 | 80-89% | 基本满足要求，内容较详细，方案合理，实施可行 |
| 一般 | 70-79% | 部分满足要求，内容一般，方案基本可行 |
| 较差 | 60-69% | 勉强满足要求，内容简单，方案存在不足 |
| 不满足 | 0-59% | 不满足要求，内容缺失，方案不可行 |

## 注意事项

### 1. API使用
- 确保通义千问API密钥有效且有足够余额
- 程序会自动添加请求间隔，避免触发频率限制
- 如果API调用失败，会使用默认评分并记录错误

### 2. 文件路径
- 确保所有路径都是绝对路径或相对于程序运行目录的正确路径
- 路径中不要包含特殊字符
- 确保有足够的文件读写权限

### 3. 网络连接
- 程序需要稳定的网络连接访问通义千问API
- 如果网络不稳定，程序会自动重试

### 4. 性能考虑
- 对于大量文件和要求，程序运行时间可能较长
- 建议在非高峰期运行程序
- 可以根据需要调整API请求间隔时间

## 故障排除

### 常见问题及解决方案

#### 1. API密钥错误
```
错误: API密钥格式不正确，应该以'sk-'开头
```
**解决方案**：检查 `llm_client.py` 中的 `DEFAULT_API_KEY` 是否设置正确

#### 2. 文件路径不存在
```
错误: 找不到要求文件 /path/to/file
```
**解决方案**：检查配置与路径设置，确保文件确实存在

#### 3. API调用失败
```
API请求失败: 401, Unauthorized
```
**解决方案**：检查API密钥是否有效，账户是否有足够余额

#### 4. 权限不足
```
Permission denied: /path/to/file
```
**解决方案**：检查文件权限，确保程序有读写权限

#### 5. 网络超时
```
API调用出错: timeout
```
**解决方案**：检查网络连接，可以适当增加TIMEOUT配置值

## 自定义配置

### 1. 修改关键词
可以在config.py中修改技术关键词和商务关键词：

```python
TECH_KEYWORDS = [
    "技术", "系统", "软件", "硬件", "设备", "功能", "性能", 
    # 添加更多技术相关关键词
]

BUSINESS_KEYWORDS = [
    "资质", "证书", "业绩", "经验", "团队", "管理", "质量", 
    # 添加更多商务相关关键词
]
```

### 2. 调整评分参数
可以修改相关性阈值和匹配文件数量：

```python
RELEVANCE_THRESHOLD = 0.3  # 降低阈值会匹配更多文件
MAX_RELEVANT_FILES = 5     # 增加数量会分析更多相关文件
```

### 3. 自定义输出格式
可以修改输出配置：

```python
OUTPUT_FORMATS = ["json", "txt", "csv", "excel"]
DEFAULT_OUTPUT_FORMAT = "json"
```

## 技术支持

如果在使用过程中遇到问题，请：

1. 检查日志文件中的错误信息
2. 确认配置文件中的参数设置
3. 验证网络连接和API密钥状态
4. 查看程序输出的详细错误信息

## 更新日志

### v1.0.0 (2024-12-20)
- 初始版本发布
- 支持基础的标文要求评分功能
- 集成通义千问API

### v1.1.0 (2024-12-20)
- 增加增强版程序
- 添加配置文件支持
- 改进错误处理和日志记录
- 支持多种输出格式

