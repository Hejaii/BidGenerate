# 智能评分程序使用说明

## 概述

智能评分程序是一个基于通义千问API的自动化评分工具，能够：
1. 读取PDF提取器生成的要求文件
2. 在标书库中智能匹配相关文件
3. 使用AI进行专业评分
4. 生成详细的评分报告

## 文件结构

```
scripts/
├── scoring_config.py          # 配置文件
├── simple_scorer.py           # 简化版评分程序（推荐使用）
├── intelligent_scorer.py      # 完整版评分程序
└── README_scoring.md          # 使用说明
```

## 安装依赖

程序会自动安装必要的依赖包：
- requests: HTTP请求
- pandas: 数据处理
- openpyxl: Excel文件处理

## 配置说明

### 1. API配置
在运行前设置环境变量，并在 `scoring_config.py` 中自动读取：
```bash
export DASHSCOPE_API_KEY='你的dashscope密钥'
```

### 2. 路径配置
```python
PROJECT_ROOT = "/path/to/your/project"
LIBRARY_ROOT = "/path/to/your/bid/library"
```

### 3. 关键词匹配规则
程序使用预定义的关键词匹配规则来找到相关文件：
- ISO认证相关：ISO9001、ISO14001、ISO45001
- 资质认证：CMA、CNAS、软件企业认定
- 人员资质：项目经理、测试工程师、数据库工程师等
- 技术方案：技术方案、测试方案、质量保证等

## 使用方法

### 1. 运行程序
```bash
cd litchi-smart-orchard-bid/scripts
python simple_scorer.py
```

### 2. 选择要求文件
程序会自动扫描项目目录，找到PDF提取器生成的要求文件：
- `03.招标文件_qualification_requirements_report_*.txt`
- `03.招标文件_qualification_requirements_data_*.json`

### 3. 自动评分过程
程序会：
1. 构建文件索引
2. 逐个分析每个要求
3. 在库中查找相关文件
4. 调用通义千问API进行评分
5. 生成评分结果

### 4. 输出文件
程序会生成两种格式的评分报告：
- 文本报告：`*_scoring_report.txt`
- Excel报告：`*_scoring_report.xlsx`

## 评分逻辑

### 评分标准
- 完全满足要求：满分
- 部分满足要求：按满足程度给分
- 不满足要求：0分
- 超出要求：最多满分

### 评分维度
每个要求会从以下维度进行评分：
- 得分/满分
- 得分率
- 详细评分说明
- 材料优势
- 材料不足
- 改进建议

## 文件匹配策略

### 1. 关键词匹配
程序使用预定义的关键词规则进行智能匹配

### 2. 文件类型分类
- 公司资质文件
- 人员资质文件
- 项目业绩文件
- 技术方案文件
- 测试方案文件
- 管理方案文件

### 3. 内容相关性分析
不仅匹配文件名，还会分析文件内容的相关性

## 注意事项

### 1. API限制
- 程序会在API请求间添加延迟，避免触发频率限制
- 建议在网络稳定的环境下运行

### 2. 文件格式
- 支持.txt和.json格式的要求文件
- 库文件需要是markdown格式

### 3. 错误处理
- 如果API调用失败，会生成默认评分结果
- 程序会记录详细的错误信息

## 自定义配置

### 1. 添加新的关键词规则
在 `scoring_config.py` 中的 `KEYWORD_MATCHING_RULES` 添加：
```python
'new_keyword': ['关键词1', '关键词2', '关键词3']
```

### 2. 修改评分提示词
在 `scoring_config.py` 中修改 `SCORING_PROMPT_TEMPLATE`

### 3. 调整API参数
修改 `scoring_config.py` 中的模型参数和超时设置

## 故障排除

### 1. API密钥错误
- 检查API密钥格式是否正确（以sk-开头）
- 确认账户余额是否充足

### 2. 文件找不到
- 检查路径配置是否正确
- 确认文件是否存在且有读取权限

### 3. 评分失败
- 检查网络连接
- 查看API响应错误信息
- 确认文件内容格式正确

## 示例输出

### 文本报告格式
```
================================================================================
智能评分报告
================================================================================
生成时间: 2024-01-15 14:30:25
总要求数: 15
总得分: 85
总分: 100
总体得分率: 85.00%

类别统计:
----------------------------------------
商务要求: 45/50 (90.00%) - 8项
技术要求: 40/50 (80.00%) - 7项

详细评分结果:
================================================================================
要求 1: 具备ISO9001质量管理体系认证
类型: 商务要求
页码: 第15页
重要性: 重要
得分: 5/5 (100.00%)
评分说明: 材料完全满足要求，提供了有效的ISO9001认证证书
优势: 认证有效期内, 覆盖范围全面
不足: 无
建议: 继续保持认证有效性
相关文件: /path/to/ISO9001.md
------------------------------------------------------------
```

### Excel报告格式
包含两个工作表：
1. 评分结果：详细的评分数据
2. 统计信息：总体统计指标

## 技术支持

如果遇到问题，请检查：
1. 配置文件设置
2. API密钥有效性
3. 文件路径正确性
4. 网络连接状态

程序会提供详细的错误信息和处理建议。



